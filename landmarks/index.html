<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<title> Landmarks </title>
		<link rel="stylesheet" href="style.css" type="text/css" />
		<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script>

			// reorganize order of functions
			var map;
			var lat = 0;
			var lng = 0;
			var login = "THERESE_COOKE";
			var markersArray = [];
			var infowindow = new google.maps.InfoWindow();
			var req = new XMLHttpRequest();
			var loc;

			// make request to data of other classmates
			req.open("POST", "https://defense-in-derpth.herokuapp.com/sendLocation", true);

			req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			// check how lat/lng are getting sent. user's are still 0/0
			// when data has been received
			req.onreadystatechange = function(){
				if (req.readyState == 4) {
					locations = JSON.parse(req.responseText);
					display_map();
				}
			}

			req.send("login=" + login + "&lat=" + lat + "&lng=" + lng);
			

			function init_map(){	

				// start by getting current location
				getLocation();

			}

			function finish_map(){
				// configure map settings
				map_settings = { center: loc, zoom: 15 };
				
				// generate map
				map = new google.maps.Map(document.getElementById('map_drop'), map_settings);
			}

			function display_map(){

				makeMarkers();

				// make polyline

			}

			// creates the user's marker
			function makeMarkers(){

				// make markers for landmarks
				for (var i = 0; i < locations.landmarks.length; i++){
					markersArray.push({

						landmarks[i] = new google.maps.Marker({
							position: {lat: locations.landmarks[i].lat, lng: locations.landmarks[i].lng},
							title: locations.landmarks[i].name,
							icon: "temple.png"
							// change size of icon
						});
					markersArray.landmarks[i].setMap(map);
				}


				// make markers for people
				for (var i = 0; i < locations.people.length; i++){
					// people[i] doesn't work
					markersArray.push({
// FIX THIS
					    marker[i]: new google.maps.Marker({
							position: {lat: locations.people[i].lat, lng: locations.people[i].lng},
							title: locations.people[i].login,
							icon: "person.png"
							// change size of icon
						});
					    dist: // haversine function
					markersArray.people[i].setMap(map);
				}

				// marker for yourself
				you = new google.maps.Marker({
					position: loc, 
					title: closestLandmark(),
					icon: "mouse.png",
					// change size of icon
				});
				you.setMap(map);

				// user's info window
				// so we don't make one of these for every person/landmark?
				google.maps.event.addListener(you, 'click', function(){
					infowindow.setContent(you.title);
					infowindow.open(map, you);
				});
			
			}

			// returns string with closest landmark to user and distance
			function closestLandmark(){

				return "make this function";
			}

			// gets location of the user
			function getLocation(){
				navigator.geolocation.getCurrentPosition(function(position){
					lat = position.coords.latitude;
					lng = position.coords.longitude;
					loc = new google.maps.LatLng(lat,lng);
									finish_map();
				});
			}



		</script>
	</head>

	<body onload="init_map()">
		<div id="map_drop"></div>

	</body>


</html>